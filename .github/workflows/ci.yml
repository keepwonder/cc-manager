name: CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Test on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Set executable permissions
      run: |
        chmod +x bin/cc-manager
        chmod +x install.sh
        chmod +x uninstall.sh
        chmod +x tests/*.sh

    - name: Check syntax
      run: make check-syntax

    - name: Validate project structure
      run: make validate

    - name: Run tests
      run: make test

  lint:
    name: Lint Shell Scripts
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Install ShellCheck
      run: |
        sudo apt-get update
        sudo apt-get install -y shellcheck

    - name: Run ShellCheck
      run: |
        find . -name "*.sh" -type f -exec shellcheck -x {} +
        shellcheck bin/cc-manager
